# yaml-language-server: $schema=https://raw.githubusercontent.com/OAI/OpenAPI-Specification/main/schemas/v3.0/schema.json
openapi: 3.0.0
info:
  title: HuntHub API
  version: 1.0.0
  description: API for managing treasure hunts
paths: {}

components:
  schemas:
    HuntStatus:
      type: string
      enum: [draft, published]
      description: "Hunt status: draft (editable) or published (read-only)"

    Location:
      type: object
      properties:
        lat:
          type: number
        lng:
          type: number
        radius:
          type: number
        address:
          type: string
          description: Cached address from geocoding
      required:
        - lat
        - lng
        - radius
      additionalProperties: false

    HuntAccessType:
      type: string
      enum: [creator, viewer, editor]

    ChallengeType:
      type: string
      enum: [clue, quiz, mission, task]

    OptionType:
      type: string
      enum: [choice, input]

    MissionType:
      type: string
      enum: [upload-media, match-location, upload-audio]

    ValidationMode:
      type: string
      enum: [exact, fuzzy, contains, numeric-range]
      description: |
        Validation mode for quiz input answers:
        - exact: Case-insensitive exact match (default)
        - fuzzy: Levenshtein distance similarity match
        - contains: Substring match
        - numeric-range: Numeric value within tolerance

    MimeTypes:
      type: string
      enum: [image/jpeg, image/png, image/webp, image/gif, video/mp4, video/webm, audio/mpeg, audio/wav, audio/ogg, audio/webm, audio/mp4]

    # ============================================================
    # Media Schemas (Step-level media attachment)
    # ============================================================

    MediaType:
      type: string
      enum: [image, audio, video, image-audio]
      description: Type of media attached to a step

    AssetSnapshot:
      type: object
      description: Snapshot of asset data (copied at selection time)
      properties:
        id:
          type: integer
          description: Asset.assetId reference
        url:
          type: string
          description: CDN URL for preview
        name:
          type: string
          description: Original filename
        sizeBytes:
          type: integer
          description: File size in bytes
      required:
        - id
        - url
        - name
        - sizeBytes
      additionalProperties: false

    ImageMedia:
      type: object
      description: Image media with nested asset snapshot
      properties:
        asset:
          $ref: '#/components/schemas/AssetSnapshot'
        title:
          type: string
          description: Display title (user-provided)
        alt:
          type: string
          description: Accessibility text for screen readers
      required:
        - asset
      additionalProperties: false

    AudioMedia:
      type: object
      description: Audio media with nested asset snapshot
      properties:
        asset:
          $ref: '#/components/schemas/AssetSnapshot'
        title:
          type: string
          description: Display title (user-provided)
        transcript:
          type: string
          description: Text transcript for accessibility
      required:
        - asset
      additionalProperties: false

    VideoMedia:
      type: object
      description: Video media with nested asset snapshot
      properties:
        asset:
          $ref: '#/components/schemas/AssetSnapshot'
        title:
          type: string
          description: Display title (user-provided)
        alt:
          type: string
          description: Accessibility text for screen readers
      required:
        - asset
      additionalProperties: false

    ImageAudioMedia:
      type: object
      description: Combined image + audio (composes ImageMedia and AudioMedia)
      properties:
        image:
          $ref: '#/components/schemas/ImageMedia'
        audio:
          $ref: '#/components/schemas/AudioMedia'
        title:
          type: string
          description: Overall title for the combined media
      required:
        - image
        - audio
      additionalProperties: false

    MediaContent:
      type: object
      description: Content container for media (discriminated by parent type field)
      properties:
        image:
          $ref: '#/components/schemas/ImageMedia'
        audio:
          $ref: '#/components/schemas/AudioMedia'
        video:
          $ref: '#/components/schemas/VideoMedia'
        imageAudio:
          $ref: '#/components/schemas/ImageAudioMedia'
      additionalProperties: false

    Media:
      type: object
      description: Step media attachment (self-contained snapshot with asset data)
      properties:
        type:
          $ref: '#/components/schemas/MediaType'
        content:
          $ref: '#/components/schemas/MediaContent'
      required:
        - type
        - content
      additionalProperties: false

    Hunt:
      type: object
      description: "Hunt DTO (merges Hunt master + HuntVersion content for frontend)"
      properties:
        huntId:
          type: integer
          example: 1332
        creatorId:
          type: string
        version:
          type: integer
          description: "Which version is this? (1, 2, 3, etc.)"
          example: 1
        latestVersion:
          type: integer
          description: "Latest draft version number"
          example: 2
        liveVersion:
          type: integer
          nullable: true
          description: "Currently published version number (null if never published)"
          example: 1
        name:
          type: string
        description:
          type: string
        status:
          $ref: '#/components/schemas/HuntStatus'
        startLocation:
          $ref: '#/components/schemas/Location'
        stepOrder:
          type: array
          description: "Ordered array of step IDs defining step sequence"
          items:
            type: integer
          example: [10, 23, 15]
        steps:
          type: array
          description: "Optional: Full step details (when populated)"
          items:
              $ref: '#/components/schemas/Step'
        isPublished:
          type: boolean
          description: "Is THIS version published?"
          example: false
        publishedAt:
          type: string
          format: date-time
          nullable: true
          description: "When this version was published (null if not published)"
          example: "2024-02-01T10:12:45Z"
        publishedBy:
          type: string
          nullable: true
          description: "User ID who published this version (null if not published)"
        isLive:
          type: boolean
          description: "Is this version currently live/active for players? (computed: version === liveVersion)"
          example: false
        releasedAt:
          type: string
          format: date-time
          nullable: true
          description: "When hunt was last released/made live (null if never released)"
          example: "2024-02-01T10:30:00Z"
        releasedBy:
          type: string
          nullable: true
          description: "User ID who released/made the hunt live (null if never released)"
        permission:
          type: string
          enum: [owner, admin, view]
          description: "Authenticated user's permission level for this hunt (included in user-specific contexts like dashboard)"
          example: "owner"
        createdAt:
          type: string
          example: "2024-02-01T10:12:45Z"
          format: date-time
        updatedAt:
          type: string
          example: "2024-02-01T10:12:45Z"
          format: date-time
        coverImage:
          allOf:
            - $ref: '#/components/schemas/Media'
          nullable: true
          description: Optional cover image for the hunt
      required:
        - huntId
        - creatorId
        - version
        - latestVersion
        - name
        - status
        - isPublished
        - stepOrder
      additionalProperties: false

    HuntCreate:
      type: object
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 100
        description:
          type: string
          maxLength: 500
        startLocation:
          $ref: '#/components/schemas/Location'
        steps:
          type: array
          items:
              $ref: '#/components/schemas/StepCreate'
        coverImage:
          allOf:
            - $ref: '#/components/schemas/Media'
          nullable: true
          description: Optional cover image for the hunt
      required:
        - name
      additionalProperties: false

    HuntUpdate:
      type: object
      description: Hunt content update (updates draft HuntVersion internally)
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 100
        description:
          type: string
          maxLength: 500
        startLocation:
          $ref: '#/components/schemas/Location'
        updatedAt:
          type: string
          format: date-time
          description: Timestamp for optimistic locking (optional)
        coverImage:
          allOf:
            - $ref: '#/components/schemas/Media'
          nullable: true
          description: Optional cover image for the hunt
      additionalProperties: false

    Step:
      type: object
      properties:
        stepId:
          type: integer
          example: 10000
        huntId:
          type: integer
          example: 1332
        type:
          $ref: '#/components/schemas/ChallengeType'
        challenge:
          $ref: '#/components/schemas/Challenge'
        media:
          $ref: '#/components/schemas/Media'
          description: Optional media attachment for this step
        requiredLocation:
          allOf:
            - $ref: '#/components/schemas/Location'
          nullable: true
        hint:
          type: string
          nullable: true
        timeLimit:
          type: number
          nullable: true
        maxAttempts:
          type: number
          nullable: true
        metadata:
          type: object
          additionalProperties: true
          description: Flexible key-value storage for extensibility
        createdAt:
          type: string
          example: "2024-02-01T10:12:45Z"
          format: date-time
        updatedAt:
          type: string
          example: "2024-02-01T10:12:45Z"
          format: date-time
      required:
        - stepId
        - huntId
        - type
        - challenge
      additionalProperties: false

    StepCreate:
      type: object
      description: Step creation (huntId comes from URL parameter)
      properties:
        type:
          $ref: '#/components/schemas/ChallengeType'
        challenge:
          $ref: '#/components/schemas/Challenge'
        media:
          $ref: '#/components/schemas/Media'
          description: Optional media attachment for this step
        requiredLocation:
          allOf:
            - $ref: '#/components/schemas/Location'
          nullable: true
        hint:
          type: string
          nullable: true
        timeLimit:
          type: number
          nullable: true
        maxAttempts:
          type: number
          nullable: true
      required:
        - type
        - challenge
      additionalProperties: false

    StepUpdate:
      type: object
      description: Step update (only editable fields, no id/huntId/timestamps)
      properties:
        type:
          $ref: '#/components/schemas/ChallengeType'
        challenge:
          $ref: '#/components/schemas/Challenge'
        media:
          $ref: '#/components/schemas/Media'
          description: Optional media attachment for this step
        requiredLocation:
          allOf:
            - $ref: '#/components/schemas/Location'
          nullable: true
        hint:
          type: string
          nullable: true
        timeLimit:
          type: number
          nullable: true
        maxAttempts:
          type: number
          nullable: true
      required:
        - type
        - challenge
      additionalProperties: false

    Challenge:
      type: object
      properties:
        clue:
          $ref: '#/components/schemas/Clue'
        quiz:
          $ref: '#/components/schemas/Quiz'
        mission:
          $ref: '#/components/schemas/Mission'
        task:
          $ref: '#/components/schemas/Task'
      additionalProperties: false

    Clue:
      type: object
      properties:
        title:
          type: string
        description:
          type: string
      additionalProperties: false

    Option:
      type: object
      properties:
        id:
          type: string
        text:
          type: string
      required:
        - id
        - text
      additionalProperties: false

    QuizValidation:
      type: object
      description: Validation configuration for quiz input answers
      properties:
        mode:
          $ref: '#/components/schemas/ValidationMode'
        caseSensitive:
          type: boolean
          default: false
          description: Whether validation should be case-sensitive (default false)
        fuzzyThreshold:
          type: number
          minimum: 1
          maximum: 100
          default: 80
          description: Similarity threshold percentage for fuzzy mode (1-100%, default 80%)
        numericTolerance:
          type: number
          minimum: 0
          description: Tolerance for numeric-range mode (expectedAnswer +/- tolerance)
        acceptableAnswers:
          type: array
          items:
            type: string
          description: Additional acceptable answers (any match is correct)
      additionalProperties: false

    Quiz:
      type: object
      properties:
        title:
          type: string
        description:
          type: string
        type:
          $ref: '#/components/schemas/OptionType'
        # For CHOICE type:
        options:
          type: array
          items:
            $ref: '#/components/schemas/Option'
          description: All answer options in display order (choice type)
        targetId:
          type: string
          description: ID of the correct answer option (choice type)
        # For INPUT type:
        expectedAnswer:
          type: string
          description: The correct answer text (input type)
        randomizeOrder:
          type: boolean
          description: Whether to randomize option order when displayed to player
        validation:
          $ref: '#/components/schemas/QuizValidation'
      additionalProperties: false

    Mission:
      type: object
      properties:
        title:
          type: string
        description:
          type: string
        referenceAssetIds:
          type: array
          items:
            type: integer
          description: Author's reference images/media shown to player
        targetLocation:
          $ref: '#/components/schemas/Location'
        type:
          $ref: '#/components/schemas/MissionType'
        aiInstructions:
          type: string
          description: Instructions for AI to validate player's upload (future feature)
        aiModel:
          type: string
          enum: [gpt-4-vision, claude-vision, gemini-vision]
          description: Which AI model to use for validation (future feature)
      additionalProperties: false

    Task:
      type: object
      properties:
        title:
          type: string
        instructions:
          type: string
          description: What the player should do (shown to player)
        aiInstructions:
          type: string
          description: Optional. Specific criteria for AI validation. If not provided, AI validates against the instructions field.
        aiModel:
          type: string
          enum: [gpt-4, claude, gemini]
          description: Which AI model to use for validation (future feature)
      required:
        - instructions
      additionalProperties: false


    User:
      type: object
      properties:
        id:
          type: string
        firebaseUid:
          type: string
        email:
          type: string
        firstName:
          type: string
        lastName:
          type: string
        displayName:
          type: string
        profilePicture:
          type: string
        bio:
          type: string
        createdAt:
          type: string
          example: "2024-02-01T10:12:45Z"
          format: date-time
        updatedAt:
          type: string
          example: "2024-02-01T10:12:45Z"
          format: date-time
      required:
        - id
        - firebaseUid
        - email
      additionalProperties: false

    HuntAccess:
      type: object
      properties:
        huntId:
          type: string
        userId:
          type: string
        accessType:
          $ref: '#/components/schemas/HuntAccessType'
        sharedAt:
          type: string
          example: "2024-02-01T10:12:45Z"
          format: date-time
      required:
        - huntId
        - userId
        - accessType
        - sharedAt
      additionalProperties: false

    AssetUsage:
      type: object
      properties:
        model:
          type: string
        field:
          type: string
        documentId:
          type: string
      required:
        - model
        - field
        - documentId
      additionalProperties: false

    StorageLocation:
      type: object
      properties:
        bucket:
          type: string
        path:
          type: string
      additionalProperties: false

    Asset:
      type: object
      properties:
        id:
          type: string
        assetId:
          type: integer
          example: 5000
        ownerId:
          type: string
        url:
          type: string
        mimeType:
          $ref: '#/components/schemas/MimeTypes'
        originalFilename:
          type: string
        size:
          type: number
          description: File size in bytes
        thumbnailUrl:
          type: string
        storageLocation:
          $ref: '#/components/schemas/StorageLocation'
        usage:
          type: array
          items:
            $ref: '#/components/schemas/AssetUsage'
          description: Track where this asset is used
        createdAt:
          type: string
          example: "2024-02-01T10:12:45Z"
          format: date-time
        updatedAt:
          type: string
          example: "2024-02-01T10:12:45Z"
          format: date-time
      required:
        - id
        - assetId
        - ownerId
        - url
        - mimeType
      additionalProperties: false

    AssetCreate:
      type: object
      properties:
        name:
          type: string
          minLength: 1
        mime:
          type: string
          minLength: 1
        sizeBytes:
          type: number
          minimum: 1
        url:
          type: string
          minLength: 1
        s3Key:
          type: string
          minLength: 1
      required:
        - name
        - mime
        - sizeBytes
        - url
        - s3Key
      additionalProperties: false

    PublishResult:
      type: object
      description: Response from publishing a hunt (minimal metadata - frontend refetches hunt data)
      properties:
        publishedVersion:
          type: integer
          description: Version number that was published
          example: 1
        newDraftVersion:
          type: integer
          description: New draft version number created
          example: 2
        publishedAt:
          type: string
          format: date-time
          example: "2024-02-01T10:12:45Z"
      required:
        - publishedVersion
        - newDraftVersion
        - publishedAt
      additionalProperties: false

    HuntProgressStatus:
      type: string
      enum: [in_progress, completed, abandoned]
      description: Player's progress status through a hunt

    Submission:
      type: object
      description: Player's submission for a step challenge
      properties:
        timestamp:
          type: string
          format: date-time
        content:
          description: Flexible submission content (answer text, asset ID, coordinates, etc.)
        isCorrect:
          type: boolean
        score:
          type: number
          description: Quality/confidence score (0-1 or 0-10)
        feedback:
          type: string
          description: Player guidance message from AI or system
        metadata:
          type: object
          additionalProperties: true
          description: Extensibility (e.g., branchTaken, AI model used)
      required:
        - timestamp
        - content
        - isCorrect
      additionalProperties: false

    StepProgress:
      type: object
      description: Progress for a single step
      properties:
        stepId:
          type: integer
          example: 10000
        attempts:
          type: integer
          default: 0
        completed:
          type: boolean
          default: false
        responses:
          type: array
          items:
            $ref: '#/components/schemas/Submission'
        startedAt:
          type: string
          format: date-time
        completedAt:
          type: string
          format: date-time
        duration:
          type: number
          description: Time spent on step in seconds
      required:
        - stepId
      additionalProperties: false

    Progress:
      type: object
      description: Player's progress through a hunt (supports anonymous players)
      properties:
        id:
          type: string
        userId:
          type: string
          description: Optional - only for authenticated players
        sessionId:
          type: string
          description: UUID for localStorage-based sessions
        isAnonymous:
          type: boolean
        huntId:
          type: integer
          example: 1332
        version:
          type: integer
          description: Which published hunt version player is playing
          example: 1
        status:
          $ref: '#/components/schemas/HuntProgressStatus'
        startedAt:
          type: string
          format: date-time
        completedAt:
          type: string
          format: date-time
        duration:
          type: number
          description: Total time in seconds
        currentStepId:
          type: integer
          description: Current step player is on
          example: 10000
        steps:
          type: array
          items:
            $ref: '#/components/schemas/StepProgress'
        playerName:
          type: string
          minLength: 1
          maxLength: 50
        rating:
          type: number
          minimum: 0
          maximum: 5
          description: Player's rating of the hunt (0-5 stars)
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
      required:
        - id
        - sessionId
        - isAnonymous
        - huntId
        - version
        - status
        - startedAt
        - currentStepId
        - playerName
      additionalProperties: false

    LiveHunt:
      type: object
      description: Runtime operational state for published hunts (tracks which version is live + metrics)
      properties:
        huntId:
          type: integer
          example: 1332
          description: FK to Hunt (unique - one live version per hunt)
        huntVersion:
          type: integer
          example: 1
          description: Which hunt version is currently live (FK to HuntVersion)
        activePlayerCount:
          type: integer
          default: 0
          description: Number of players currently playing this hunt
        lastPlayedAt:
          type: string
          format: date-time
          description: When someone last played this hunt
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
      required:
        - huntId
        - huntVersion
        - activePlayerCount
      additionalProperties: false

    ReleaseResult:
      type: object
      description: Lightweight response for hunt release operations
      properties:
        huntId:
          type: integer
          example: 1332
        liveVersion:
          type: integer
          example: 2
          description: Version that is now live
        previousLiveVersion:
          type: integer
          nullable: true
          example: 1
          description: Version that was live before (null if first release)
        releasedAt:
          type: string
          format: date-time
          description: When the version was released
        releasedBy:
          type: string
          description: User ID who released the version
      required:
        - huntId
        - liveVersion
        - previousLiveVersion
        - releasedAt
        - releasedBy
      additionalProperties: false

    TakeOfflineResult:
      type: object
      description: Lightweight response for taking hunt offline
      properties:
        huntId:
          type: integer
          example: 1332
        previousLiveVersion:
          type: integer
          example: 2
          description: Version that was live before taking offline
        takenOfflineAt:
          type: string
          format: date-time
          description: When the hunt was taken offline
      required:
        - huntId
        - previousLiveVersion
        - takenOfflineAt
      additionalProperties: false

    Collaborator:
      type: object
      description: Represents a user who has access to a hunt (for GET /hunts/:huntId/access endpoint)
      properties:
        userId:
          type: string
          description: User's ID
        displayName:
          type: string
          description: User's display name
        email:
          type: string
          format: email
          description: User's email address
        profilePicture:
          type: string
          description: User's profile picture URL
        permission:
          type: string
          enum: [admin, view]
          description: User's permission level (owner is not listed as collaborator)
        sharedAt:
          type: string
          format: date-time
          description: When access was granted
          example: "2024-02-01T10:30:00Z"
        sharedBy:
          type: string
          description: Display name of user who granted access
      required:
        - userId
        - displayName
        - permission
        - sharedAt
      additionalProperties: false

    ShareResult:
      type: object
      description: Response from sharing a hunt with another user
      properties:
        huntId:
          type: integer
          example: 1332
          description: ID of the hunt that was shared
        sharedWithId:
          type: string
          description: User ID of the person the hunt was shared with
        permission:
          type: string
          enum: [admin, view]
          description: Permission level granted
        sharedAt:
          type: string
          format: date-time
          description: When the hunt was shared
          example: "2024-02-01T10:30:00Z"
        sharedBy:
          type: string
          description: User ID who granted the access
      required:
        - huntId
        - sharedWithId
        - permission
        - sharedAt
        - sharedBy
      additionalProperties: false

    ReleaseHuntRequest:
      type: object
      description: Request body for releasing a hunt version (optimistic locking)
      properties:
        version:
          type: integer
          description: Version number to release (optional - auto-detects latest published if not provided)
          example: 1
        currentLiveVersion:
          type: integer
          nullable: true
          description: Current live version number for optimistic locking (null if never released)
          example: 1
      additionalProperties: false

    TakeOfflineRequest:
      type: object
      description: Request body for taking a hunt offline (optimistic locking)
      properties:
        currentLiveVersion:
          type: integer
          nullable: true
          description: Current live version number for optimistic locking
          example: 2
      required:
        - currentLiveVersion
      additionalProperties: false

    ShareHuntRequest:
      type: object
      description: Request body for sharing a hunt with another user
      properties:
        email:
          type: string
          format: email
          description: Email of the user to share with
        permission:
          type: string
          enum: [admin, view]
          description: Permission level to grant
      required:
        - email
        - permission
      additionalProperties: false

    UpdatePermissionRequest:
      type: object
      description: Request body for updating a collaborator's permission level
      properties:
        permission:
          type: string
          enum: [admin, view]
          description: New permission level
      required:
        - permission
      additionalProperties: false

    # ============================================================
    # PLAYER FORMAT SCHEMAS (Stripped for Player - no answers)
    # See: .claude/player/PLAYER-FORMAT.md
    # ============================================================

    CluePF:
      type: object
      description: "Player Format - Clue (same as Clue, no answers to strip)"
      properties:
        title:
          type: string
        description:
          type: string
      required:
        - title
        - description
      additionalProperties: false

    QuizPF:
      type: object
      description: "Player Format - Quiz without correct answer"
      properties:
        title:
          type: string
        description:
          type: string
        type:
          $ref: '#/components/schemas/OptionType'
        options:
          type: array
          items:
            $ref: '#/components/schemas/Option'
          description: Options to display (may be randomized by backend)
        randomizeOrder:
          type: boolean
      required:
        - title
        - description
        - type
      additionalProperties: false

    MissionPF:
      type: object
      description: "Player Format - Mission without target location"
      properties:
        title:
          type: string
        description:
          type: string
        type:
          $ref: '#/components/schemas/MissionType'
        referenceAssetIds:
          type: array
          items:
            type: integer
          description: Reference images shown to player
      required:
        - title
        - description
        - type
      additionalProperties: false

    TaskPF:
      type: object
      description: "Player Format - Task without AI instructions"
      properties:
        title:
          type: string
        instructions:
          type: string
          description: What the player should do
      required:
        - title
        - instructions
      additionalProperties: false

    ChallengePF:
      type: object
      description: "Player Format - Challenge container (only one populated based on step.type)"
      properties:
        clue:
          $ref: '#/components/schemas/CluePF'
        quiz:
          $ref: '#/components/schemas/QuizPF'
        mission:
          $ref: '#/components/schemas/MissionPF'
        task:
          $ref: '#/components/schemas/TaskPF'
      additionalProperties: false

    StepPF:
      type: object
      description: "Player Format - Step without answers or internal metadata"
      properties:
        stepId:
          type: integer
          example: 10000
        type:
          $ref: '#/components/schemas/ChallengeType'
        challenge:
          $ref: '#/components/schemas/ChallengePF'
        media:
          $ref: '#/components/schemas/Media'
          description: Optional media attachment
        timeLimit:
          type: integer
          nullable: true
          description: Time limit in seconds (for display - server enforces)
        maxAttempts:
          type: integer
          nullable: true
          description: Maximum attempts allowed (for display - server enforces)
        hasHint:
          type: boolean
          description: Whether this step has a hint available
      required:
        - stepId
        - type
        - challenge
        - hasHint
      additionalProperties: false

    HuntMetaPF:
      type: object
      description: "Player Format - Hunt metadata (no steps)"
      properties:
        huntId:
          type: integer
          example: 1332
        name:
          type: string
        description:
          type: string
        totalSteps:
          type: integer
          description: Total number of steps in the hunt
        coverImage:
          allOf:
            - $ref: '#/components/schemas/Media'
          nullable: true
      required:
        - huntId
        - name
        - totalSteps
      additionalProperties: false

    # ============================================================
    # PLAY SESSION SCHEMAS (For Play API)
    # ============================================================

    # ============================================================
    # Answer Validation Schemas
    # ============================================================

    AnswerType:
      type: string
      enum: [clue, quiz-choice, quiz-input, mission-location, mission-media, task]
      description: Type of answer being submitted

    ClueAnswerPayload:
      type: object
      description: Clue acknowledgment (no actual answer needed)
      additionalProperties: false

    QuizChoicePayload:
      type: object
      description: Multiple choice quiz answer
      properties:
        optionId:
          type: string
          minLength: 1
      required:
        - optionId
      additionalProperties: false

    QuizInputPayload:
      type: object
      description: Free text quiz answer
      properties:
        answer:
          type: string
          minLength: 1
          maxLength: 500
      required:
        - answer
      additionalProperties: false

    MissionLocationPayload:
      type: object
      description: GPS location for location-based missions
      properties:
        lat:
          type: number
          minimum: -90
          maximum: 90
        lng:
          type: number
          minimum: -180
          maximum: 180
      required:
        - lat
        - lng
      additionalProperties: false

    MissionMediaPayload:
      type: object
      description: Uploaded media for media missions
      properties:
        assetId:
          type: integer
          minimum: 1
      required:
        - assetId
      additionalProperties: false

    TaskAnswerPayload:
      type: object
      description: Free text response for tasks
      properties:
        response:
          type: string
          minLength: 1
          maxLength: 500
      required:
        - response
      additionalProperties: false

    AnswerPayload:
      type: object
      description: Container for answer data (only one field populated based on answerType)
      properties:
        clue:
          $ref: '#/components/schemas/ClueAnswerPayload'
        quizChoice:
          $ref: '#/components/schemas/QuizChoicePayload'
        quizInput:
          $ref: '#/components/schemas/QuizInputPayload'
        missionLocation:
          $ref: '#/components/schemas/MissionLocationPayload'
        missionMedia:
          $ref: '#/components/schemas/MissionMediaPayload'
        task:
          $ref: '#/components/schemas/TaskAnswerPayload'
      additionalProperties: false

    # ============================================================
    # Session Schemas
    # ============================================================

    StartSessionRequest:
      type: object
      description: Request to start a play session
      properties:
        playerName:
          type: string
          minLength: 1
          maxLength: 50
        email:
          type: string
          format: email
      required:
        - playerName
      additionalProperties: false

    ValidateAnswerRequest:
      type: object
      description: Request to validate a player's answer (session tracks current step)
      properties:
        answerType:
          $ref: '#/components/schemas/AnswerType'
        payload:
          $ref: '#/components/schemas/AnswerPayload'
      required:
        - answerType
        - payload
      additionalProperties: false

    ValidateAnswerResponse:
      type: object
      description: Lightweight response from validating an answer (client uses prefetched cache for next step)
      properties:
        correct:
          type: boolean
        feedback:
          type: string
          description: Hint or explanation message
        isComplete:
          type: boolean
          description: Whether the hunt is complete
        attempts:
          type: integer
          description: Number of attempts on this step
        maxAttempts:
          type: integer
          description: Maximum attempts allowed for this step
        expired:
          type: boolean
          description: Whether the time limit expired
        exhausted:
          type: boolean
          description: Whether all attempts have been used
      required:
        - correct
        - attempts
      additionalProperties: false

    HintResponse:
      type: object
      description: Response with hint data
      properties:
        hint:
          type: string
        hintsUsed:
          type: integer
        maxHints:
          type: integer
      required:
        - hint
        - hintsUsed
        - maxHints
      additionalProperties: false

    # ============================================================
    # HATEOAS Link Schemas (REST Best Practice for Navigation)
    # ============================================================

    HateoasLink:
      type: object
      description: Hypermedia link for REST navigation
      properties:
        href:
          type: string
          description: URL to the linked resource
      required:
        - href
      additionalProperties: false

    StepLinks:
      type: object
      description: HATEOAS links for step navigation
      properties:
        self:
          $ref: '#/components/schemas/HateoasLink'
        next:
          $ref: '#/components/schemas/HateoasLink'
        validate:
          $ref: '#/components/schemas/HateoasLink'
      required:
        - self
        - validate
      additionalProperties: false

    ValidateAnswerLinks:
      type: object
      description: HATEOAS links returned after validation
      properties:
        currentStep:
          $ref: '#/components/schemas/HateoasLink'
        nextStep:
          $ref: '#/components/schemas/HateoasLink'
      required:
        - currentStep
      additionalProperties: false

    StepResponse:
      type: object
      description: Step data with HATEOAS navigation links
      properties:
        step:
          $ref: '#/components/schemas/StepPF'
        stepIndex:
          type: integer
          description: Current step index (0-based)
        totalSteps:
          type: integer
          description: Total number of steps in the hunt
        attempts:
          type: integer
          description: Number of attempts made on this step
        maxAttempts:
          type: integer
          nullable: true
          description: Maximum attempts allowed (null = unlimited)
        hintsUsed:
          type: integer
          description: Number of hints used on this step
        maxHints:
          type: integer
          description: Maximum hints available per step
        _links:
          $ref: '#/components/schemas/StepLinks'
      required:
        - step
        - stepIndex
        - totalSteps
        - attempts
        - maxAttempts
        - hintsUsed
        - maxHints
        - _links
      additionalProperties: false

    SessionResponse:
      type: object
      description: Unified session response - used for both starting and resuming a session
      properties:
        sessionId:
          type: string
          format: uuid
        hunt:
          $ref: '#/components/schemas/HuntMetaPF'
          description: Hunt metadata (name, description, cover image)
        status:
          type: string
          description: "Session status: 'in_progress' or 'completed'"
        currentStepIndex:
          type: integer
          description: Current step index (0-based)
        currentStepId:
          type: integer
          nullable: true
          description: Current step ID (null when session is completed)
        totalSteps:
          type: integer
          description: Total number of steps in the hunt
        startedAt:
          type: string
          format: date-time
          description: When the session started
        completedAt:
          type: string
          format: date-time
          description: When the session was completed (if finished)
      required:
        - sessionId
        - hunt
        - status
        - currentStepIndex
        - totalSteps
        - startedAt
      additionalProperties: false

    # ============================================================
    # Pagination Schemas (Standard Offset-Based REST Pattern)
    # ============================================================

    SortOrder:
      type: string
      enum: [asc, desc]
      description: Sort order direction
      example: desc

    HuntSortField:
      type: string
      enum: [createdAt, updatedAt]
      description: Field to sort hunts by
      example: updatedAt

    AssetSortField:
      type: string
      enum: [createdAt, originalFilename, size]
      description: Field to sort assets by
      example: createdAt

    PaginationQueryParams:
      type: object
      description: Standard pagination query parameters
      properties:
        page:
          type: integer
          minimum: 1
          default: 1
          description: Page number (1-indexed)
          example: 1
        limit:
          type: integer
          minimum: 1
          maximum: 100
          default: 10
          description: Number of items per page (max 100)
          example: 10
        sortOrder:
          $ref: '#/components/schemas/SortOrder'
      additionalProperties: false

    HuntQueryParams:
      allOf:
        - $ref: '#/components/schemas/PaginationQueryParams'
        - type: object
          properties:
            sortBy:
              $ref: '#/components/schemas/HuntSortField'
          additionalProperties: false

    AssetQueryParams:
      allOf:
        - $ref: '#/components/schemas/PaginationQueryParams'
        - type: object
          properties:
            sortBy:
              $ref: '#/components/schemas/AssetSortField'
            mimeType:
              $ref: '#/components/schemas/MimeTypes'
              description: Optional filter by MIME type
          additionalProperties: false

    PaginationMeta:
      type: object
      description: Pagination metadata in response
      properties:
        total:
          type: integer
          description: Total number of items across all pages
          example: 47
        page:
          type: integer
          description: Current page number (1-indexed)
          example: 1
          minimum: 1
        limit:
          type: integer
          description: Number of items per page
          example: 10
          minimum: 1
        totalPages:
          type: integer
          description: Total number of pages
          example: 5
          minimum: 0
        hasNext:
          type: boolean
          description: Whether there is a next page
          example: true
        hasPrev:
          type: boolean
          description: Whether there is a previous page
          example: false
      required:
        - total
        - page
        - limit
        - totalPages
        - hasNext
        - hasPrev
      additionalProperties: false

    PaginatedHuntsResponse:
      type: object
      description: Paginated response for hunts list
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Hunt'
        pagination:
          $ref: '#/components/schemas/PaginationMeta'
      required:
        - data
        - pagination
      additionalProperties: false

    PaginatedAssetsResponse:
      type: object
      description: Paginated response for assets list
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Asset'
        pagination:
          $ref: '#/components/schemas/PaginationMeta'
      required:
        - data
        - pagination
      additionalProperties: false

